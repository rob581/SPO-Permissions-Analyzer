<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        Title="SharePoint Permissions Tool" Height="750" Width="1100"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#0078D4" Padding="15">
            <StackPanel HorizontalAlignment="Center">
                <TextBlock Text="SharePoint Online Permissions Tool" 
                          FontSize="18" FontWeight="Bold" Foreground="White" 
                          HorizontalAlignment="Center"/>
                <TextBlock Text="App Registration Authentication" 
                          FontSize="12" Foreground="White" 
                          HorizontalAlignment="Center" Margin="0,2,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- Main Content -->
        <TabControl Grid.Row="1" Margin="10">
            <!-- Connection Tab -->
            <TabItem Header="Connection">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Tenant URL Input -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,15">
                        <TextBlock Text="SharePoint Tenant URL:" Margin="0,0,0,5" FontWeight="SemiBold"/>
                        <TextBox Name="txtTenantUrl" Height="30" FontSize="12"
                                Text="https://yourtenant.sharepoint.com"/>
                        <TextBlock Text="Example: https://contoso.sharepoint.com" 
                                  FontSize="10" Foreground="Gray" Margin="0,2,0,0"/>
                    </StackPanel>
                    
                    <!-- Client ID Input -->
                    <StackPanel Grid.Row="1" Margin="0,0,0,15">
                        <TextBlock Text="App Registration Client ID:" Margin="0,0,0,5" FontWeight="SemiBold"/>
                        <TextBox Name="txtClientId" Height="30" FontSize="12" Text=""/>
                        <TextBlock Text="GUID format: 12345678-1234-1234-1234-123456789012" 
                                  FontSize="10" Foreground="Gray" Margin="0,2,0,0"/>
                    </StackPanel>
                    
                    <!-- Info Panel -->
                    <Border Grid.Row="2" Background="#F0F8FF" BorderBrush="#0078D4" 
                           BorderThickness="1" Padding="10" Margin="0,0,0,15">
                        <StackPanel>
                            <TextBlock Text="App Registration Requirements:" FontWeight="SemiBold" 
                                      Foreground="#0078D4" Margin="0,0,0,5"/>
                            <TextBlock Text="• Redirect URI: http://localhost" FontSize="11" Margin="0,0,0,2"/>
                            <TextBlock Text="• API Permissions: Sites.FullControl.All, User.Read.All" FontSize="11" Margin="0,0,0,2"/>
                            <TextBlock Text="• Grant admin consent for the permissions" FontSize="11" Margin="0,0,0,2"/>
                            <TextBlock Text="• Set as public client (Allow public client flows = Yes)" FontSize="11"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Buttons -->
                    <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,15">
                        <Button Name="btnConnectSPO" Content="Connect to SharePoint" 
                               Width="200" Height="35" Background="#0078D4" Foreground="White"
                               FontWeight="SemiBold" Margin="0,0,10,0"/>
                        <Button Name="btnDemoMode" Content="Demo Mode" 
                               Width="120" Height="35" Margin="0,0,0,0"/>
                    </StackPanel>
                    
                    <!-- Results -->
                    <ScrollViewer Grid.Row="4">
                        <TextBox Name="txtSPOResults" IsReadOnly="True" 
                                TextWrapping="Wrap" AcceptsReturn="True"
                                Background="#F5F5F5" FontFamily="Consolas" FontSize="11"
                                Text="Enter your SharePoint tenant URL and App Registration Client ID, then click Connect to SharePoint."/>
                    </ScrollViewer>
                </Grid>
            </TabItem>
            
            <!-- SharePoint Operations Tab -->
            <TabItem Header="SharePoint Operations">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Connection Status -->
                    <Border Grid.Row="0" Background="#F0F0F0" Padding="10" Margin="0,0,0,15">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Connection Status: " FontWeight="SemiBold"/>
                            <TextBlock Name="txtStatus" Text="Not connected to SharePoint" 
                                      Foreground="Red"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Site URL Input -->
                    <StackPanel Grid.Row="1" Margin="0,0,0,15">
                        <TextBlock Text="Site URL for Permissions Analysis (Optional):" Margin="0,0,0,5" FontWeight="SemiBold"/>
                        <TextBox Name="txtSiteUrl" Height="30" FontSize="12"/>
                        <TextBlock Text="Leave empty for tenant-level operations, or enter specific site URL" 
                                  FontSize="10" Foreground="Gray" Margin="0,2,0,0"/>
                    </StackPanel>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,15">
                        <Button Name="btnGetSites" Content="Get All Sites" Width="120" Height="30" 
                               Margin="0,0,10,0" IsEnabled="False"/>
                        <Button Name="btnGetPermissions" Content="Analyze Permissions" Width="140" Height="30" 
                               Margin="0,0,10,0" IsEnabled="False"/>
                        <Button Name="btnGenerateReport" Content="Generate Report" Width="120" Height="30" 
                               IsEnabled="False"/>
                    </StackPanel>
                    
                    <!-- Help Text -->
                    <TextBlock Grid.Row="3" Text="Operations available after connecting to SharePoint:" 
                              FontStyle="Italic" Foreground="Gray" Margin="0,0,0,10"/>
                    
                    <!-- Operations Results -->
                    <ScrollViewer Grid.Row="4">
                        <TextBox Name="txtOperationsResults" IsReadOnly="True" 
                                TextWrapping="Wrap" AcceptsReturn="True"
                                Background="#F5F5F5" FontFamily="Consolas" FontSize="11"
                                Text="Connect to SharePoint to begin operations..."/>
                    </ScrollViewer>
                </Grid>
            </TabItem>
            
            <!-- Visual Analytics Tab -->
            <TabItem Header="Visual Analytics">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Analytics Header -->
                    <Border Grid.Row="0" Background="#F8F9FA" BorderBrush="#E9ECEF" 
                           BorderThickness="1" Padding="15" Margin="0,0,0,15" CornerRadius="5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="[CHART]" FontSize="20" Margin="0,0,10,0" Foreground="#007ACC"/>
                            <StackPanel>
                                <TextBlock Name="txtAnalyticsTitle" Text="SharePoint Analytics Dashboard" 
                                          FontSize="16" FontWeight="Bold" Foreground="#495057"/>
                                <TextBlock Name="txtAnalyticsSubtitle" Text="Run an analysis to view visual insights" 
                                          FontSize="12" Foreground="#6C757D" Margin="0,2,0,0"/>
                            </StackPanel>
                            <Button Name="btnRefreshAnalytics" Content="Refresh" 
                                   Width="100" Height="30" Margin="20,0,0,0"
                                   Background="#28A745" Foreground="White" IsEnabled="False"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Analytics Content -->
                    <ScrollViewer Grid.Row="1" Name="scrollAnalytics">
                        <Grid Name="gridAnalyticsContent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Key Metrics Cards -->
                            <Grid Grid.Row="0" Margin="0,0,0,20" Name="gridMetricsCards">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Total Sites Card -->
                                <Border Grid.Column="0" Background="#E3F2FD" BorderBrush="#1976D2" 
                                       BorderThickness="2" Padding="15" Margin="0,0,10,0" CornerRadius="8">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="[SITE]" FontSize="24" HorizontalAlignment="Center" Foreground="#1976D2"/>
                                        <TextBlock Name="txtTotalSites" Text="0" FontSize="28" FontWeight="Bold" 
                                                  Foreground="#1976D2" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total Sites" FontSize="12" FontWeight="SemiBold" 
                                                  Foreground="#1976D2" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Total Users Card -->
                                <Border Grid.Column="1" Background="#E8F5E8" BorderBrush="#2E7D32" 
                                       BorderThickness="2" Padding="15" Margin="0,0,10,0" CornerRadius="8">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="[USERS]" FontSize="24" HorizontalAlignment="Center" Foreground="#2E7D32"/>
                                        <TextBlock Name="txtTotalUsers" Text="0" FontSize="28" FontWeight="Bold" 
                                                  Foreground="#2E7D32" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total Users" FontSize="12" FontWeight="SemiBold" 
                                                  Foreground="#2E7D32" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Total Groups Card -->
                                <Border Grid.Column="2" Background="#FFF3E0" BorderBrush="#F57C00" 
                                       BorderThickness="2" Padding="15" Margin="0,0,10,0" CornerRadius="8">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="[GROUPS]" FontSize="20" HorizontalAlignment="Center" Foreground="#F57C00"/>
                                        <TextBlock Name="txtTotalGroups" Text="0" FontSize="28" FontWeight="Bold" 
                                                  Foreground="#F57C00" HorizontalAlignment="Center"/>
                                        <TextBlock Text="SharePoint Groups" FontSize="12" FontWeight="SemiBold" 
                                                  Foreground="#F57C00" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- External Users Card -->
                                <Border Grid.Column="3" Background="#FFEBEE" BorderBrush="#C62828" 
                                       BorderThickness="2" Padding="15" CornerRadius="8">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="[EXT]" FontSize="24" HorizontalAlignment="Center" Foreground="#C62828"/>
                                        <TextBlock Name="txtExternalUsers" Text="0" FontSize="28" FontWeight="Bold" 
                                                  Foreground="#C62828" HorizontalAlignment="Center"/>
                                        <TextBlock Text="External Users" FontSize="12" FontWeight="SemiBold" 
                                                  Foreground="#C62828" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                            
                            <!-- Charts Row -->
                            <Grid Grid.Row="1" Margin="0,0,0,20" Name="gridCharts">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Sites by Storage Chart -->
                                <Border Grid.Column="0" Background="White" BorderBrush="#E9ECEF" 
                                       BorderThickness="1" Padding="15" Margin="0,0,10,0" CornerRadius="8">
                                    <StackPanel>
                                        <TextBlock Text="Sites by Storage Usage" FontSize="14" FontWeight="Bold" 
                                                  Foreground="#495057" Margin="0,0,0,15"/>
                                        <Canvas Name="canvasStorageChart" Height="200" Background="#FAFAFA"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Permission Distribution Chart -->
                                <Border Grid.Column="1" Background="White" BorderBrush="#E9ECEF" 
                                       BorderThickness="1" Padding="15" Margin="10,0,0,0" CornerRadius="8">
                                    <StackPanel>
                                        <TextBlock Text="Permission Level Distribution" FontSize="14" FontWeight="Bold" 
                                                  Foreground="#495057" Margin="0,0,0,15"/>
                                        <Canvas Name="canvasPermissionChart" Height="200" Background="#FAFAFA"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                            
                            <!-- Sites List with Visual Indicators -->
                            <Border Grid.Row="2" Background="White" BorderBrush="#E9ECEF" 
                                   BorderThickness="1" Padding="15" Margin="0,0,0,20" CornerRadius="8">
                                <StackPanel>
                                    <TextBlock Text="Sites Overview" FontSize="14" FontWeight="Bold" 
                                              Foreground="#495057" Margin="0,0,0,15"/>
                                    <DataGrid Name="dgSites" Height="250" AutoGenerateColumns="False" 
                                             IsReadOnly="True" GridLinesVisibility="None" 
                                             Background="White" AlternatingRowBackground="#F8F9FA">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Site Title" Binding="{Binding Title}" Width="200"/>
                                            <DataGridTextColumn Header="URL" Binding="{Binding Url}" Width="250"/>
                                            <DataGridTextColumn Header="Owner" Binding="{Binding Owner}" Width="150"/>
                                            <DataGridTextColumn Header="Storage (MB)" Binding="{Binding Storage}" Width="100"/>
                                            <DataGridTemplateColumn Header="Usage Level" Width="120">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border CornerRadius="10" Padding="5,2" 
                                                               Background="{Binding UsageColor}">
                                                            <TextBlock Text="{Binding UsageLevel}" 
                                                                      Foreground="White" FontSize="10" 
                                                                      HorizontalAlignment="Center"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                            
                            <!-- Permissions Analysis -->
                            <Border Grid.Row="3" Background="White" BorderBrush="#E9ECEF" 
                                   BorderThickness="1" Padding="15" CornerRadius="8">
                                <StackPanel>
                                    <TextBlock Text="Recent Permission Changes and Alerts" FontSize="14" FontWeight="Bold" 
                                              Foreground="#495057" Margin="0,0,0,15"/>
                                    <ListBox Name="lstPermissionAlerts" Height="200" Background="#FAFAFA" 
                                            BorderThickness="0">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Padding="10" Margin="0,2" CornerRadius="5" 
                                                       Background="{Binding AlertColor}">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding AlertText}" FontWeight="SemiBold" 
                                                                  Foreground="White"/>
                                                        <TextBlock Text="{Binding AlertDetails}" FontSize="11" 
                                                                  Foreground="White" Opacity="0.9" Margin="0,2,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </ScrollViewer>
                </Grid>
            </TabItem>
            
            <!-- Help Tab -->
            <TabItem Header="Help">
                <ScrollViewer Margin="20">
                    <StackPanel>
                        <TextBlock Text="SharePoint Permissions Tool - Help" FontSize="16" FontWeight="Bold" 
                                  Margin="0,0,0,15"/>
                        
                        <TextBlock Text="App Registration Setup:" FontSize="14" FontWeight="SemiBold" 
                                  Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,15">
                            1. Go to Azure Portal > App registrations > New registration<LineBreak/>
                            2. Name: 'SharePoint Permissions Tool'<LineBreak/>
                            3. Supported account types: Single tenant<LineBreak/>
                            4. Redirect URI: Web > http://localhost<LineBreak/>
                            5. Register the application
                        </TextBlock>
                        
                        <TextBlock Text="Configure Permissions:" FontSize="14" FontWeight="SemiBold" 
                                  Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,15">
                            1. Go to API permissions<LineBreak/>
                            2. Add permission > Microsoft Graph > Delegated permissions<LineBreak/>
                            3. Add: Sites.FullControl.All, User.Read.All, Group.Read.All<LineBreak/>
                            4. Add permission > SharePoint > Delegated permissions<LineBreak/>
                            5. Add: AllSites.FullControl<LineBreak/>
                            6. Grant admin consent for your organization
                        </TextBlock>
                        
                        <TextBlock Text="Enable Public Client:" FontSize="14" FontWeight="SemiBold" 
                                  Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,15">
                            1. Go to Authentication<LineBreak/>
                            2. Scroll down to 'Allow public client flows'<LineBreak/>
                            3. Set to 'Yes'<LineBreak/>
                            4. Save
                        </TextBlock>
                        
                        <TextBlock Text="Usage:" FontSize="14" FontWeight="SemiBold" 
                                  Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,15">
                            1. Copy the Application (client) ID from your app registration<LineBreak/>
                            2. Enter your SharePoint tenant URL and Client ID<LineBreak/>
                            3. Click 'Connect to SharePoint'<LineBreak/>
                            4. Complete authentication in the popup window<LineBreak/>
                            5. Use the SharePoint Operations tab to analyze permissions<LineBreak/>
                            6. View visual insights in the Visual Analytics tab
                        </TextBlock>
                        
                        <TextBlock Text="Visual Analytics Features:" FontSize="14" FontWeight="SemiBold" 
                                  Margin="0,15,0,10"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,15">
                            • Key metrics dashboard with site, user, and group counts<LineBreak/>
                            • Storage usage charts and permission distribution<LineBreak/>
                            • Sites overview with visual usage indicators<LineBreak/>
                            • Permission alerts and security insights<LineBreak/>
                            • Interactive data grids and visual charts
                        </TextBlock>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Window>